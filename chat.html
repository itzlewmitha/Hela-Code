<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hela Code Playground</title>
  <link rel="stylesheet" href="style.css">
  <!-- Add Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- Authentication required message -->
  <div id="authRequired" class="auth-required" style="display: none;">
    <h2>Authentication Required</h2>
    <p>You need to log in to access Hela Code. Please sign in to continue using our AI coding assistant.</p>
    <button class="auth-btn" id="goToLoginBtn">Go to Login</button>
  </div>

  <!-- Main chat interface -->
  <div id="chatInterface" style="display: none;">
    <!-- Sidebar for chat history -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">Hela Code</div>
        
        <!-- Credit System Display -->
        <div class="credit-system">
          <div class="credit-balance">
            <span class="credit-amount" id="creditAmount">‚Çπ100</span>
            <span class="credit-label">Available Credits</span>
          </div>
          <div class="credit-features">
            <div class="feature-locked" data-feature="code-download">
              üîí Code Download (‚Çπ50+ required)
            </div>
            <div class="feature-locked" data-feature="code-execution">
              üîí Code Execution (‚Çπ50+ required)
            </div>
          </div>
          <button class="top-up-btn" onclick="showTopUpModal()">
            üí∞ Top Up Credits
          </button>
        </div>

        <button class="new-chat-btn" id="newChatBtn">
          + New Chat
        </button>

        <!-- Feature Buttons -->
        <div class="feature-buttons">
          <button class="feature-btn" onclick="learningChallenges.showChallengesModal()">
            üöÄ Challenges
          </button>
          <button class="feature-btn" onclick="achievementSystem.showAchievementsModal()">
            üèÜ Achievements
          </button>
          <button class="feature-btn" onclick="voiceAssistant.toggleListening()">
            üé§ Voice
          </button>
        </div>
      </div>
      
      <div class="chat-history" id="chatHistory">
        <!-- Chat history items will be populated by JavaScript -->
      </div>
      
      <div class="sidebar-footer">
        <div class="user-avatar" id="userAvatar">U</div>
        <div class="user-name" id="userName">User</div>
        <button class="logout-btn" id="logoutBtn" title="Logout">üö™</button>
      </div>
    </div>
    
    <!-- Mobile menu toggle -->
    <button class="menu-toggle" id="menuToggle">‚ò∞</button>
    
    <!-- Overlay for mobile -->
    <div class="overlay" id="overlay"></div>

    <!-- Scroll to top button -->
    <button class="scroll-to-top" id="scrollToTop" title="Scroll to top">‚Üë</button>

    <div class="chat-container with-sidebar" id="chatContainer">
      <!-- greeting / home screen -->
      <div id="greetingSection" class="center-content">
        <div class="greeting-message">Welcome to <span style="color:#a259ff">Hela Code</span></div>
        <div class="example-prompts">
          <div class="example-prompt" onclick="handleExamplePrompt('How do I create a REST API with Node.js and Express?')">
            <div class="prompt-icon">üåê</div>
            <div class="prompt-title">Build a REST API</div>
            <div class="prompt-desc">Learn to create APIs with Node.js, Express, and best practices</div>
          </div>
          <div class="example-prompt" onclick="handleExamplePrompt('Can you help me debug this Python function that processes data?')">
            <div class="prompt-icon">üêõ</div>
            <div class="prompt-title">Debug Python Code</div>
            <div class="prompt-desc">Get help identifying and fixing bugs in your Python code</div>
          </div>
          <div class="example-prompt" onclick="handleExamplePrompt('Explain how to use React hooks with practical examples')">
            <div class="prompt-icon">‚öõÔ∏è</div>
            <div class="prompt-title">React Hooks Guide</div>
            <div class="prompt-desc">Understand useState, useEffect, and custom hooks with examples</div>
          </div>
        </div>
      </div>

      <!-- chat area -->
      <div id="chat" class="chat-box"></div>

      <!-- input area -->
      <div class="chat-input-bar">
        <div class="chat-input-inner">
          <textarea id="input" placeholder="Ask me anything about technology, programming, or development..." rows="1"></textarea>
          <button id="send" class="send-btn">‚û§</button>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    // Handle example prompt clicks
    function handleExamplePrompt(promptText) {
      document.getElementById('input').value = promptText;
      document.getElementById('send').click();
    }

    // Check if user is logged in (now handled by Firebase auth state)
    const user = JSON.parse(localStorage.getItem('helaUser'));
    
    if (!user) {
      // Show authentication required message
      document.getElementById('authRequired').style.display = 'flex';
      document.getElementById('chatInterface').style.display = 'none';
      
      // Redirect to login when button is clicked
      document.getElementById('goToLoginBtn').addEventListener('click', function() {
        window.location.href = 'index.html';
      });
    } else {
      // Show chat interface - Firebase will handle the actual authentication
      document.getElementById('authRequired').style.display = 'none';
      document.getElementById('chatInterface').style.display = 'block';
    }
    
    // Mobile menu toggle
    document.getElementById('menuToggle').addEventListener('click', function() {
      document.getElementById('sidebar').classList.toggle('open');
      document.getElementById('overlay').classList.toggle('open');
    });
    
    // Close sidebar when clicking overlay
    document.getElementById('overlay').addEventListener('click', function() {
      document.getElementById('sidebar').classList.remove('open');
      document.getElementById('overlay').classList.remove('open');
    });
    
    // Logout functionality
    document.getElementById('logoutBtn').addEventListener('click', function() {
      firebase.auth().signOut().then(() => {
        localStorage.removeItem('helaUser');
        localStorage.removeItem('helaChatHistory');
        localStorage.removeItem('helaCredits');
        window.location.href = 'index.html';
      });
    });
    
    // New chat button
    document.getElementById('newChatBtn').addEventListener('click', function() {
      if (typeof createNewChat === 'function') {
        createNewChat();
      }
    });
    
    // Initialize scroll to top functionality
    function initScrollToTop() {
      const scrollToTopBtn = document.getElementById('scrollToTop');
      const chatBox = document.getElementById('chat');
      
      if (!scrollToTopBtn || !chatBox) return;
      
      // Show/hide scroll to top button based on scroll position
      chatBox.addEventListener('scroll', function() {
        if (chatBox.scrollTop > 300) {
          scrollToTopBtn.classList.add('visible');
        } else {
          scrollToTopBtn.classList.remove('visible');
        }
      });
      
      // Scroll to top when button is clicked
      scrollToTopBtn.addEventListener('click', function() {
        chatBox.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
      
      // Also allow clicking on greeting section to scroll to top
      const greetingSection = document.getElementById('greetingSection');
      if (greetingSection) {
        greetingSection.addEventListener('click', function() {
          chatBox.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
      }
    }

    // Initialize scroll to top
    initScrollToTop();
  </script>
</body>
</html>
