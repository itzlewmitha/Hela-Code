<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hela Code - Login</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
</head>
<body class="auth-page">
    <div class="auth-container">
        <div class="auth-header">
            <h1>ðŸš€ Hela Code</h1>
            <p>Your AI Programming Assistant</p>
        </div>
        
        <div class="auth-card">
            <h2>Welcome Back</h2>
            <p class="auth-subtitle">Sign in to continue your coding journey</p>
            
            <form id="loginForm" class="auth-form">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" required placeholder="Enter your email">
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required placeholder="Enter your password">
                </div>
                
                <button type="submit" class="auth-btn">
                    <span class="btn-text">Sign In</span>
                    <span class="btn-loading" style="display: none;">Signing in...</span>
                </button>
            </form>
            
            <div class="auth-footer">
                <p>Don't have an account? <a href="#" id="showRegister">Sign up</a></p>
            </div>
        </div>

        <div class="auth-card" id="registerCard" style="display: none;">
            <h2>Create Account</h2>
            <p class="auth-subtitle">Join Hela Code today</p>
            
            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label for="regName">Full Name</label>
                    <input type="text" id="regName" name="name" required placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label for="regEmail">Email</label>
                    <input type="email" id="regEmail" name="email" required placeholder="Enter your email">
                </div>
                
                <div class="form-group">
                    <label for="regPassword">Password</label>
                    <input type="password" id="regPassword" name="password" required placeholder="Create a password" minlength="6">
                </div>
                
                <button type="submit" class="auth-btn">
                    <span class="btn-text">Create Account</span>
                    <span class="btn-loading" style="display: none;">Creating account...</span>
                </button>
            </form>
            
            <div class="auth-footer">
                <p>Already have an account? <a href="#" id="showLogin">Sign in</a></p>
            </div>
        </div>

        <div class="auth-features">
            <div class="feature">
                <div class="feature-icon">ðŸ’¬</div>
                <h3>AI-Powered Chat</h3>
                <p>Get instant help with programming questions</p>
            </div>
            <div class="feature">
                <div class="feature-icon">ðŸš€</div>
                <h3>Learning Challenges</h3>
                <p>Complete coding challenges to level up</p>
            </div>
            <div class="feature">
                <div class="feature-icon">ðŸŽ¯</div>
                <h3>Voice Programming</h3>
                <p>Use voice commands for hands-free coding</p>
            </div>
        </div>
    </div>

    <div id="notification" class="notification" style="display: none;"></div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAkZ1COLT59ukLGzpv5lW3UZ8vQ9tEN1gw",
            authDomain: "hela-code.firebaseapp.com",
            projectId: "hela-code",
            storageBucket: "hela-code.appspot.com",
            messagingSenderId: "813299203715",
            appId: "1:813299203715:web:910e7227cdd4a09ad1a5b6"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();

        // DOM Elements
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const loginCard = document.querySelector('.auth-card');
        const registerCard = document.getElementById('registerCard');
        const showRegister = document.getElementById('showRegister');
        const showLogin = document.getElementById('showLogin');
        const notification = document.getElementById('notification');

        // Toggle between login and register
        showRegister.addEventListener('click', (e) => {
            e.preventDefault();
            loginCard.style.display = 'none';
            registerCard.style.display = 'block';
        });

        showLogin.addEventListener('click', (e) => {
            e.preventDefault();
            registerCard.style.display = 'none';
            loginCard.style.display = 'block';
        });

        // Show notification
        function showNotification(message, type = 'error') {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }

        // Show loading state
        function setLoading(button, isLoading) {
            const btnText = button.querySelector('.btn-text');
            const btnLoading = button.querySelector('.btn-loading');
            
            if (isLoading) {
                btnText.style.display = 'none';
                btnLoading.style.display = 'inline';
                button.disabled = true;
            } else {
                btnText.style.display = 'inline';
                btnLoading.style.display = 'none';
                button.disabled = false;
            }
        }

        // Handle login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const button = e.target.querySelector('button[type="submit"]');
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            setLoading(button, true);
            
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                console.log('User signed in:', userCredential.user);
                
                // Redirect to chat page
                window.location.href = 'chat.html';
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Failed to sign in. Please try again.';
                
                switch (error.code) {
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'This account has been disabled.';
                        break;
                    case 'auth/user-not-found':
                        errorMessage = 'No account found with this email.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Incorrect password.';
                        break;
                    default:
                        errorMessage = error.message;
                }
                
                showNotification(errorMessage, 'error');
            } finally {
                setLoading(button, false);
            }
        });

        // Handle registration
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const button = e.target.querySelector('button[type="submit"]');
            
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            
            setLoading(button, true);
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                // Update user profile
                await userCredential.user.updateProfile({
                    displayName: name
                });
                
                console.log('User created:', userCredential.user);
                showNotification('Account created successfully!', 'success');
                
                // Redirect to chat page after a brief delay
                setTimeout(() => {
                    window.location.href = 'chat.html';
                }, 1500);
                
            } catch (error) {
                console.error('Registration error:', error);
                let errorMessage = 'Failed to create account. Please try again.';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'An account with this email already exists.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Password should be at least 6 characters.';
                        break;
                    default:
                        errorMessage = error.message;
                }
                
                showNotification(errorMessage, 'error');
            } finally {
                setLoading(button, false);
            }
        });

        // Check if user is already logged in
        auth.onAuthStateChanged((user) => {
            if (user) {
                console.log('User already logged in, redirecting...');
                window.location.href = 'chat.html';
            }
        });
    </script>
</body>
</html>
